{% extends 'dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Analytics - AI Customer Support{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/analytics.css' %}">
{% endblock %}

{% block dashboard_content %}
<div class="analytics-container" id="analyticsContainer">
    <!-- Header -->
    <div class="analytics-header">
        <div class="row align-items-center">
            <div class="col">
                <h1>Analytics & Insights</h1>
                <p class="text-muted">Real-time performance metrics and trends</p>
            </div>
            <div class="col-auto">
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="period" id="today" autocomplete="off">
                    <label class="btn btn-outline-primary" for="today">Today</label>

                    <input type="radio" class="btn-check" name="period" id="week" checked>
                    <label class="btn btn-outline-primary" for="week">Week</label>

                    <input type="radio" class="btn-check" name="period" id="month">
                    <label class="btn btn-outline-primary" for="month">Month</label>
                </div>
                <div class="btn-group ms-2">
                    <button class="btn btn-primary" id="exportPDF">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="btn btn-outline-primary" id="exportCSV">
                        <i class="fas fa-file-csv"></i> CSV
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="row g-4 mt-3">
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon bg-primary">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <div class="stat-content">
                    <h3 id="totalTickets">0</h3>
                    <p>Total Tickets</p>
                    <small id="ticketTrend"></small>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon bg-success">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <h3 id="resolvedTickets">0</h3>
                    <p>Resolved</p>
                    <small><span id="resolutionRate">0%</span> resolution rate</small>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon bg-warning">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <h3 id="avgResponseTime">0m</h3>
                    <p>Avg Response Time</p>
                    <small class="text-success"><i class="fas fa-arrow-down"></i> 15% faster</small>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="stat-icon bg-info">
                    <i class="fas fa-smile"></i>
                </div>
                <div class="stat-content">
                    <h3 id="csatScore">0</h3>
                    <p>CSAT Score</p>
                    <small class="text-success"><i class="fas fa-arrow-up"></i> Above target</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-4 mt-3">
        <!-- Ticket Trends -->
        <div class="col-lg-8">
            <div class="chart-card">
                <div class="chart-header">
                    <h5><i class="fas fa-chart-line"></i> Ticket Trends</h5>
                    <label for="trendMetric"></label><select class="form-select form-select-sm" style="width: auto;" id="trendMetric">
                        <option value="count">Count</option>
                        <option value="resolution_time">Resolution Time</option>
                        <option value="response_time">Response Time</option>
                    </select>
                </div>
                <div class="chart-body">
                    <canvas id="ticketTrendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Sentiment Distribution -->
        <div class="col-lg-4">
            <div class="chart-card">
                <div class="chart-header">
                    <h5><i class="fas fa-heart"></i> Sentiment Analysis</h5>
                </div>
                <div class="chart-body">
                    <canvas id="sentimentChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mt-3">
        <!-- Category Performance -->
        <div class="col-lg-6">
            <div class="chart-card">
                <div class="chart-header">
                    <h5><i class="fas fa-tags"></i> Tickets by Category</h5>
                </div>
                <div class="chart-body">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Agent Performance -->
        <div class="col-lg-6">
            <div class="chart-card">
                <div class="chart-header">
                    <h5><i class="fas fa-users"></i> Agent Performance</h5>
                </div>
                <div class="chart-body">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Tables -->
    <div class="row g-4 mt-3">
        <div class="col-12">
            <div class="data-table">
                <div class="chart-header" style="padding: 1.5rem;">
                    <h5><i class="fas fa-table"></i> Detailed Analytics</h5>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary active" data-table="categories">Categories</button>
                        <button class="btn btn-outline-primary" data-table="agents">Agents</button>
                        <button class="btn btn-outline-primary" data-table="time">Time Analysis</button>
                    </div>
                </div>
                <table class="table" id="analyticsTable">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Total Tickets</th>
                            <th>Resolved</th>
                            <th>Avg Time</th>
                            <th>CSAT</th>
                            <th>Trend</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data loaded via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/analytics.js' %}"></script>
{% endblock %}
